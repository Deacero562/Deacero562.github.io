<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Agregar Liquidez Automático</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body>
  <h1>Agregar Liquidez</h1>
  <button id="btnAddLiquidity">Agregar Liquidez</button>

  <script>
    async function addLiquidityAuto() {
      if (!window.ethereum) {
        alert("Por favor instala MetaMask!");
        return;
      }

      const provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      const signer = provider.getSigner();
      const userAddress = await signer.getAddress();

      const routerAddress = "0x344ec156133A57169cb50d8f2A67f9e9023698fc"; // Tu contrato SimpleUniswapRouter
      const tokenAAddress = "0xa37D029DE7c770ef8DE20fB1225167f84ae9DeC8";   // Token A
      const tokenBAddress = "0x788839617211f1056Ef48C3B425A102E804A5A36";   // Token B

      const erc20Abi = [
        "function approve(address spender, uint256 amount) external returns (bool)",
        "function allowance(address owner, address spender) external view returns (uint256)"
      ];

      const routerAbi = [
        "function addLiquidity(address tokenA, address tokenB, uint amountADesired, uint amountBDesired, uint amountAMin, uint amountBMin, address to, uint deadline) external returns (uint amountA, uint amountB, uint liquidity)"
      ];

      const tokenAContract = new ethers.Contract(tokenAAddress, erc20Abi, signer);
      const tokenBContract = new ethers.Contract(tokenBAddress, erc20Abi, signer);
      const routerContract = new ethers.Contract(routerAddress, routerAbi, signer);

      const amountADesired = ethers.utils.parseUnits("10", 18); // Cambiar cantidad
      const amountBDesired = ethers.utils.parseUnits("10", 18); // Cambiar cantidad

      // Aprobar token A
      const allowanceA = await tokenAContract.allowance(userAddress, routerAddress);
      if (allowanceA.lt(amountADesired)) {
        const txApproveA = await tokenAContract.approve(routerAddress, amountADesired);
        await txApproveA.wait();
        console.log("Token A aprobado");
      } else {
        console.log("Token A ya aprobado");
      }

      // Aprobar token B
      const allowanceB = await tokenBContract.allowance(userAddress, routerAddress);
      if (allowanceB.lt(amountBDesired)) {
        const txApproveB = await tokenBContract.approve(routerAddress, amountBDesired);
        await txApproveB.wait();
        console.log("Token B aprobado");
      } else {
        console.log("Token B ya aprobado");
      }

      const deadline = Math.floor(Date.now() / 1000) + 60 * 10; // 10 minutos desde ahora

      try {
        const txAdd = await routerContract.addLiquidity(
          tokenAAddress,
          tokenBAddress,
          amountADesired,
          amountBDesired,
          amountADesired,
          amountBDesired,
          userAddress,
          deadline
        );
        console.log("Agregando liquidez...");
        await txAdd.wait();
        alert("Liquidez agregada con éxito!");
      } catch (error) {
        console.error("Error agregando liquidez:", error);
        alert("Error: " + (error.data?.message || error.message));
      }
    }

    document.getElementById("btnAddLiquidity").onclick = addLiquidityAuto;
  </script>
</body>
</html>
