<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SimpleSwap DEX</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; }
    label { display: block; margin-top: 1rem; }
    input[type=text], input[type=number] { width: 100%; padding: 0.5rem; margin-top: 0.25rem; }
    button { margin-top: 1rem; padding: 0.75rem 1.5rem; }
    #status { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>SimpleSwap DEX - Sepolia</h1>

  <div>
    <label>Token A address:
      <input type="text" id="tokenA" readonly />
    </label>
    <label>Token B address:
      <input type="text" id="tokenB" readonly />
    </label>
  </div>

  <div>
    <label>Amount In (Token A):
      <input type="number" id="amountIn" min="0" step="any" placeholder="Amount of Token A to swap" />
    </label>

    <label>Minimum Amount Out (Token B):
      <input type="number" id="amountOutMin" min="0" step="any" placeholder="Minimum amount of Token B to receive" />
    </label>

    <label>Deadline (unix timestamp):
      <input type="number" id="deadline" min="0" placeholder="Deadline timestamp" />
    </label>

    <label>Recipient address:
      <input type="text" id="recipient" placeholder="Address to receive Token B" />
    </label>

    <button id="connectBtn">Connect Wallet</button>
    <button id="swapBtn" disabled>Swap Tokens</button>

    <div id="status"></div>
  </div>

  <script>
    // === SET HERE YOUR DEPLOYED CONTRACTS ===
    const SIMPLE_SWAP_ADDRESS = "0x344ec156133A57169cb50d8f2A67f9e9023698fc";
    const TOKEN_A_ADDRESS = "0x694C824819eF1f34EE04f591d1f2a2DABB89590E";
    const TOKEN_B_ADDRESS = "0x0f1b9B2B99F58Fd9cf0Adf729863844812F2401C";

    document.getElementById("tokenA").value = TOKEN_A_ADDRESS;
    document.getElementById("tokenB").value = TOKEN_B_ADDRESS;

    // Minimal ABI fragments for interacting with contracts
    const erc20Abi = [
      "function approve(address spender, uint256 amount) external returns (bool)",
      "function allowance(address owner, address spender) external view returns (uint256)",
      "function decimals() view returns (uint8)",
      "function balanceOf(address) view returns (uint256)",
      "event Approval(address indexed owner, address indexed spender, uint256 value)"
    ];

    const simpleSwapAbi = [
      "function swapExactTokensForTokens(uint256 amountIn, uint256 amountOutMin, address[] calldata path, address to, uint256 deadline) external returns (uint256[] memory amounts)",
      "function getPrice(address tokenA, address tokenB) external view returns (uint256)"
    ];

    let provider, signer;
    let simpleSwapContract, tokenAContract, tokenBContract;

    async function connectWallet() {
      if (!window.ethereum) {
        alert("MetaMask is required!");
        return;
      }
      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();

        simpleSwapContract = new ethers.Contract(SIMPLE_SWAP_ADDRESS, simpleSwapAbi, signer);
        tokenAContract = new ethers.Contract(TOKEN_A_ADDRESS, erc20Abi, signer);
        tokenBContract = new ethers.Contract(TOKEN_B_ADDRESS, erc20Abi, signer);

        document.getElementById("status").innerText = "Wallet connected!";
        document.getElementById("swapBtn").disabled = false;
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = "Failed to connect wallet.";
      }
    }

    async function swapTokens() {
      try {
        const amountInInput = document.getElementById("amountIn").value;
        const amountOutMinInput = document.getElementById("amountOutMin").value;
        const deadlineInput = document.getElementById("deadline").value;
        const recipient = document.getElementById("recipient").value;

        if (!amountInInput || !amountOutMinInput || !deadlineInput || !recipient) {
          alert("Please fill all fields.");
          return;
        }

        const amountIn = ethers.utils.parseUnits(amountInInput, 18);
        const amountOutMin = ethers.utils.parseUnits(amountOutMinInput, 18);
        const deadline = Number(deadlineInput);

        // Check allowance and approve if needed
        const allowance = await tokenAContract.allowance(await signer.getAddress(), SIMPLE_SWAP_ADDRESS);
        if (allowance.lt(amountIn)) {
          document.getElementById("status").innerText = "Approving Token A...";
          const approveTx = await tokenAContract.approve(SIMPLE_SWAP_ADDRESS, amountIn);
          await approveTx.wait();
        }

        document.getElementById("status").innerText = "Swapping tokens...";
        const tx = await simpleSwapContract.swapExactTokensForTokens(
          amountIn,
          amountOutMin,
          [TOKEN_A_ADDRESS, TOKEN_B_ADDRESS],
          recipient,
          deadline
        );
        await tx.wait();
        document.getElementById("status").innerText = "Swap completed successfully!";
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = "Swap failed: " + (error.data?.message || error.message);
      }
    }

    document.getElementById("connectBtn").addEventListener("click", connectWallet);
    document.getElementById("swapBtn").addEventListener("click", swapTokens);
  </script>
</body>
</html>
